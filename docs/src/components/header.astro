---
import { CATEGORIZED } from "@/lib/categorized";
import { CATEGORIZED as V1_CATEGORIZED } from "@/lib/v1/categorized";
import { getNavbarEntries } from "@/lib/navbar-entries";
import { GitHubLogoIcon } from "@radix-ui/react-icons";
import { buttonVariants } from "@shadcn/button";
import { MobileNav } from "./mobile-nav";
import { ThemeSwitcher } from "./theme-switcher";
import { values } from "remeda";
import { VERSIONS } from "./version-selector";

const { pathname } = Astro.url;
const trimmed = pathname.replace(/\/$/, "");

const isV1 = pathname === VERSIONS.v1.path;
const NAVBAR_ENTRIES = await getNavbarEntries(
  isV1 ? V1_CATEGORIZED : CATEGORIZED,
  ({ data }) => isV1 === data.isV1,
);
---

<header
  class="sticky top-0 z-50 flex h-16 flex-none items-center gap-2 border-b border-border/40 bg-background/95 px-8 backdrop-blur supports-[backdrop-filter]:bg-background/60"
>
  <nav class="flex flex-1 items-center gap-8">
    <a href="/" class="font-bold"> Remeda </a>
    <div class="flex-1">
      <a
        href="/docs/"
        class:list={[
          "transition-colors hover:text-foreground/80",
          values(VERSIONS).some(({ path }) => path === trimmed)
            ? "font-semibold text-primary"
            : "text-foreground/60",
        ]}
      >
        Documentation
      </a>
    </div>
    <a
      href="https://github.com/remeda/remeda"
      target="_blank"
      class={buttonVariants({ variant: "ghost", size: "icon" })}
    >
      <GitHubLogoIcon />
      <span class="sr-only">GitHub</span>
    </a>
  </nav>
  <ThemeSwitcher client:load />
  <MobileNav
    pathname={pathname}
    entries={NAVBAR_ENTRIES}
    client:media="(max-width: 767px)"
  />
</header>
