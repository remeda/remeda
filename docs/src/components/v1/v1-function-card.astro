---
import FunctionCard from "@/components/function-card.astro";
import type { DocumentedFunction } from "@/lib/transform";
import { getEntry } from "astro:content";
import { MigrationBox } from "./migration-box";
import Markdown from "../markdown.astro";

const MIGRATION_COLLECTION = "v1-migration";

type Props = {
  readonly func: DocumentedFunction;
};

const { func } = Astro.props;

const entry = await getEntry(MIGRATION_COLLECTION, func.name.toLowerCase());
const Migration = await entry?.render();
const hasMigration = Migration !== undefined;
---

<FunctionCard func={func}>
  <MigrationBox client:load hasMigration={hasMigration}>
    {
      hasMigration ? (
        <Markdown className="max-w-none prose-p:max-w-prose prose-h1:text-xl prose-h1:font-bold prose-h2:text-lg prose-h2:font-semibold prose-h2:mb-2 prose-h3:text-base prose-h3:font-semibold">
          <Migration.Content />
        </Markdown>
      ) : undefined
    }
  </MigrationBox>
</FunctionCard>
