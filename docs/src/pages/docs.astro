---
import DocsSection from "@/components/docs-section.astro";
import FunctionCard from "@/components/function-card.astro";
import { functionsCollectionName } from "@/content/functions/content.config";
import DocsPage from "@/layouts/docs-page.astro";
import { v2Functions, v2NavBarEntries } from "@/lib/entries";
import { getCollection } from "astro:content";

const entries = await getCollection(functionsCollectionName);
const internalNames = new Set(entries.map(({ data: { name } }) => name));

const categorizedFunctions = await v2Functions();
const navbarEntries = v2NavBarEntries(categorizedFunctions);
---

<DocsPage
  showVersionSelector
  title="Documentation"
  navbarEntries={navbarEntries}
>
  {
    categorizedFunctions.map(([category, functions]) => (
      <DocsSection title={category}>
        {functions.map((entry) => (
          <FunctionCard entry={entry} internalNames={internalNames} />
        ))}
      </DocsSection>
    ))
  }
</DocsPage>
