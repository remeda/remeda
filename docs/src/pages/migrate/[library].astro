---
import DocsSection from "@/components/docs-section.astro";
import MappingFunctionCard from "@/components/mapping-function-card.astro";
import DocsPage from "@/layouts/docs-page.astro";
import { ALL_LIBRARIES } from "@/lib/libraries";
import { getMappingEntries } from "@/lib/mappings";
import type { GetStaticPaths, InferGetStaticParamsType } from "astro";
import { sortBy } from "remeda";

export const getStaticPaths = (async () =>
  ALL_LIBRARIES.map((library) => ({
    params: { library },
  }))) satisfies GetStaticPaths;

const { library } = Astro.params as InferGetStaticParamsType<
  typeof getStaticPaths
>;

const mappingEntries = await getMappingEntries(library);

const forDisplay = sortBy(mappingEntries, ([category]) => category);
---

<DocsPage categorized={mappingEntries} title={`Migrate: ${library}`}>
  {
    forDisplay.map(([category, functions]) => (
      <DocsSection title={category}>
        {functions.map(({ name }) => (
          <MappingFunctionCard name={name} library={library} />
        ))}
      </DocsSection>
    ))
  }
</DocsPage>
